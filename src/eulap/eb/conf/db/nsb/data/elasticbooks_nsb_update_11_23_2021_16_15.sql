
-- Description	: Update script for November 23, 2021

-- Petty Cash Voucher Liquidation
source ~/CMS/src/eulap/eb/conf/db/disbursement/petty_cash_voucher_liquidation.sql
source ~/CMS/src/eulap/eb/conf/db/disbursement/petty_cash_voucher_liquidation_line.sql

INSERT INTO OBJECT_TYPE VALUES (24013, 'PETTY_CASH_VOUCHER_LIQUIDATION', 'PETTY_CASH_VOUCHER_LIQUIDATION', 'eulap.eb.service.PettyCashVoucherLiquidationService', 1, 1, NOW(), 1, NOW());
INSERT INTO OBJECT_TYPE VALUES (24014, 'PETTY_CASH_VOUCHER_LIQUIDATION_LINE', 'PETTY_CASH_VOUCHER_LIQUIDATION_LINE', 'eulap.eb.service.PettyCashVoucherLiquidationService', 1, 1, NOW(), 1, NOW());

-- Update AP Invoice
source ~/CMS/src/eulap/eb/conf/db/nsb/data/update_ap_invoice_add_new_columns_and_modify_11_16_2021_11_05.sql

-- Petty Cash Replenishment
source ~/CMS/src/eulap/eb/conf/db/disbursement/petty_cash_replenishment_line.sql
source ~/CMS/src/eulap/eb/conf/db/nsb/data/insert_pcr_invoice_types_11_19_2021_10_02.sql

INSERT INTO OR_TYPE VALUES (24008, 'Petty-Cash-Replenishment-Line-PCVLL-Obj-Relationship', 1, 1, now(), 1, now());
INSERT INTO OBJECT_TYPE VALUES (24016, 'PETTY_CASH_REPLENISHMENT', 'AP_INVOICE','eulap.eb.service.PettyCashReplenishmentService', 1, 1, NOW(), 1, NOW());
INSERT INTO OBJECT_TYPE VALUES (24015, 'PETTY_CASH_REPLENISHMENT_LINE', 'PETTY_CASH_REPLENISHMENT_LINE','eulap.eb.service.PettyCashReplenishmentService', 1, 1, NOW(), 1, NOW());

source ~/CMS/src/eulap/eb/conf/db/revenue/custodian_account_supplier.sql
source ~/CMS/src/eulap/eb/conf/db/sp/sp_get_invoice_aging.sql

INSERT INTO SUPPLIER (NAME, ACTIVE, CREATED_BY, CREATED_DATE, UPDATED_BY, UPDATED_DATE, EB_SL_KEY_ID, BUSINESS_CLASSIFICATION_ID, BUS_REG_TYPE_ID,
 STREET_BRGY, CITY_PROVINCE, TIN)
SELECT CA.CUSTODIAN_NAME, CA.ACTIVE, CA.CREATED_BY, CA.CREATED_DATE, CA.UPDATED_BY, CA.UPDATED_DATE, 1, 2, 1, 'N/A', 'N/A', 'N/A'
FROM CUSTODIAN_ACCOUNT CA WHERE CA.CUSTODIAN_ACCOUNT_ID 
NOT IN(SELECT CAS.CUSTODIAN_ACCOUNT_ID FROM CUSTODIAN_ACCOUNT_SUPPLIER CAS);

INSERT INTO SUPPLIER_ACCOUNT (NAME, ACTIVE, CREATED_BY, CREATED_DATE, UPDATED_BY, UPDATED_DATE, COMPANY_ID, TERM_ID, DEFAULT_CREDIT_AC_ID, SUPPLIER_ID)
SELECT CA.CUSTODIAN_ACCOUNT_NAME, CA.ACTIVE, CA.CREATED_BY, CA.CREATED_DATE, CA.UPDATED_BY, CA.UPDATED_DATE, CA.COMPANY_ID,
CA.TERM_ID, CA.CD_ACCOUNT_COMBINATION_ID, (SELECT S.SUPPLIER_ID FROM SUPPLIER S WHERE S.NAME = CA.CUSTODIAN_NAME)
FROM CUSTODIAN_ACCOUNT CA WHERE CA.CUSTODIAN_ACCOUNT_ID 
NOT IN(SELECT CAS.CUSTODIAN_ACCOUNT_ID FROM CUSTODIAN_ACCOUNT_SUPPLIER CAS);

INSERT INTO CUSTODIAN_ACCOUNT_SUPPLIER (CUSTODIAN_ACCOUNT_ID, SUPPLIER_ID, SUPPLIER_ACCOUNT_ID, CREATED_BY, CREATED_DATE, UPDATED_BY, UPDATED_DATE)
SELECT CA.CUSTODIAN_ACCOUNT_ID, (SELECT S.SUPPLIER_ID FROM SUPPLIER S WHERE S.NAME = CA.CUSTODIAN_NAME),
(SELECT SA.SUPPLIER_ACCOUNT_ID FROM SUPPLIER_ACCOUNT SA WHERE SA.NAME = CA.CUSTODIAN_ACCOUNT_NAME),
CA.CREATED_BY, CA.CREATED_DATE, CA.UPDATED_BY, CA.UPDATED_DATE
FROM CUSTODIAN_ACCOUNT CA WHERE CA.CUSTODIAN_ACCOUNT_ID 
NOT IN(SELECT CAS.CUSTODIAN_ACCOUNT_ID FROM CUSTODIAN_ACCOUNT_SUPPLIER CAS);