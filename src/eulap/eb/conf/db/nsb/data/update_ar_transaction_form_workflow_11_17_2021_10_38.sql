
-- Description	: Update script that will fix the form workflow for AR transaction


UPDATE FORM_WORKFLOW_LOG FWL
INNER JOIN AR_TRANSACTION ART ON ART.FORM_WORKFLOW_ID = FWL.FORM_WORKFLOW_ID
SET FWL.FORM_STATUS_ID = 7
WHERE FWL.FORM_STATUS_ID = 17;

INSERT INTO FORM_WORKFLOW_LOG (FORM_WORKFLOW_ID, FORM_STATUS_ID, CREATED_BY, CREATED_DATE)
SELECT ART.FORM_WORKFLOW_ID, 30, 1, FWL.CREATED_DATE FROM FORM_WORKFLOW_LOG FWL
INNER JOIN AR_TRANSACTION ART ON ART.FORM_WORKFLOW_ID = FWL.FORM_WORKFLOW_ID
WHERE FWL.FORM_STATUS_ID = 7;

UPDATE FORM_WORKFLOW FW
INNER JOIN AR_TRANSACTION ART ON ART.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID
SET FW.CURRENT_STATUS_ID = 7
WHERE FW.CURRENT_STATUS_ID = 17;