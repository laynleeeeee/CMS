
# Description	: Project Retention - NSB 5 form workflow and journal entries configuration

ProjectRetention4.typeId=1
ProjectRetention4.form=projectRetention/4/viewForm
ProjectRetention4.edit=project_retention_nsb5_edit
ProjectRetention4.print=projectRetention/pdf
ProjectRetention4.service=eulap.eb.service.ProjectRetentionService
ProjectRetention4.oo.parent_to_child=1
ProjectRetention4.oo.child_to_child=24007
ProjectRetention4.flow=1;2;3
ProjectRetention4.1.statusId=1
ProjectRetention4.1.required=
ProjectRetention4.1.next=2
ProjectRetention4.1.product_code=24124
ProjectRetention4.1.module_code=8
ProjectRetention4.2.statusId=30
ProjectRetention4.2.required=1
ProjectRetention4.2.next=3
ProjectRetention4.2.product_code=24124
ProjectRetention4.2.module_code=16
ProjectRetention4.3.statusId=7
ProjectRetention4.3.required=1
ProjectRetention4.3.next=0
ProjectRetention4.3.product_code=24124
ProjectRetention4.3.module_code=32
ProjectRetention4.sql.entries=1;2;3;4;5;6
# AR RETENTION (DEBIT)
ProjectRetention4.sql.1.je=SELECT 'PROJECT RETENTION - NSB 5' AS SOURCE, PR.PROJECT_RETENTION_ID AS ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER AS ACCT_NO, \
	A.ACCOUNT_NAME, PR.DATE AS GL_DATE, CONCAT('PR ', PR.SEQUENCE_NO) AS REFERENCE_NUMBER, \
	PR.REMARKS AS DESCRIPTION, PR.AMOUNT AS DEBIT, 0 AS CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE AS IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Withholding Tax (CREDIT)
ProjectRetention4.sql.2.je=SELECT 'PROJECT RETENTION - NSB 5' AS SOURCE, PR.PROJECT_RETENTION_ID AS ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER AS ACCT_NO, \
	A.ACCOUNT_NAME, PR.DATE AS GL_DATE, CONCAT('PR ', PR.SEQUENCE_NO) AS REFERENCE_NUMBER, \
	PR.REMARKS AS DESCRIPTION, PR.WT_AMOUNT AS DEBIT, 0 AS CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE AS IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN WT_ACCOUNT_SETTING WTAS ON WTAS.WT_ACCOUNT_SETTING_ID = PR.WT_ACCOUNT_SETTING_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = WTAS.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.DIVISION_ID = PR.DIVISION_ID \
	AND PR.WT_ACCOUNT_SETTING_ID IS NOT NULL \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# AR (CREDIT)
ProjectRetention4.sql.3.je=SELECT 'PROJECT RETENTION - NSB 5' AS SOURCE, PR.PROJECT_RETENTION_ID AS ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER AS ACCT_NO, \
	A.ACCOUNT_NAME, PR.DATE AS GL_DATE, CONCAT('PR ', PR.SEQUENCE_NO) AS REFERENCE_NUMBER, \
	PR.REMARKS AS DESCRIPTION, 0 AS DEBIT, PRL.AMOUNT AS CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE AS IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_LINE PRL ON PRL.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	INNER JOIN AR_CUSTOMER_ACCOUNT ARC ON ARC.AR_CUSTOMER_ACCOUNT_ID = PR.AR_CUSTOMER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARC.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID 
# VAT (CREDIT)
ProjectRetention4.sql.4.je=SELECT 'PROJECT RETENTION - NSB 5' as SOURCE, PR.PROJECT_RETENTION_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, A.ACCOUNT_ID, \
	D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, PR.DATE as GL_DATE, \
	CONCAT('PR ', PR.SEQUENCE_NO) as REFERENCE_NUMBER, PR.REMARKS AS DESCRIPTION, 0 AS DEBIT, \
	COALESCE(PRL.VAT_AMOUNT, 0) as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, \
	FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_LINE PRL ON PRL.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	INNER JOIN VAT_ACCOUNT_SETUP VAS ON (VAS.COMPANY_ID = PR.COMPANY_ID AND VAS.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = VAS.OUTPUT_VAT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND VAS.TAX_TYPE_ID = PRL.TAX_TYPE_ID \
	AND PRL.TAX_TYPE_ID IN (1, 4, 5, 6, 8, 9) \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Gain (Debit)
ProjectRetention4.sql.5.je=SELECT 'PROJECT RETENTION - NSB 5' as SOURCE, PR.PROJECT_RETENTION_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, PR.DATE as GL_DATE, CONCAT('PR ', PR.SEQUENCE_NO) as REFERENCE_NUMBER, \
	'' AS DESCRIPTION, \
	ABS((SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
	WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0))) as DEBIT, 0 AS CREDIT,  \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND (SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
		WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
		GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0)) > 0 \
	AND PR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Loss (Credit)
ProjectRetention4.sql.6.je=SELECT 'PROJECT RETENTION - NSB 5' as SOURCE, PR.PROJECT_RETENTION_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, PR.DATE as GL_DATE, CONCAT('PR ', PR.SEQUENCE_NO) as REFERENCE_NUMBER, \
	'' AS DESCRIPTION, 0 AS DEBIT,  \
	ABS((SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
	WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0))) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
    AND (SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
		WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
		GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0)) < 0 \
	AND PR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.je.jerr=AND PR.DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN CONCAT('PR ', PR.SEQUENCE_NO) like IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER like IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'PROJECT RETENTION - NSB 5' THEN PR.PROJECT_RETENTION_ID != 0 \
		WHEN 'ALL' THEN PR.PROJECT_RETENTION_ID != 0 \
		ELSE PR.PROJECT_RETENTION_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN FW.IS_COMPLETE = IN_IS_POSTED ELSE FW.IS_COMPLETE != IN_IS_POSTED END)
ProjectRetention4.sql.je.ab=AND IF(DATE_FROM IS NOT NULL, PR.DATE BETWEEN DATE_FROM AND DATE_TO, PR.DATE <= DATE_TO) \
	AND IF(IN_DIVISION_ID != -1, PR.DIVISION_ID = IN_DIVISION_ID, PR.DIVISION_ID != IN_DIVISION_ID) \
	AND FW.IS_COMPLETE = 1
ProjectRetention4.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND PR.DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.IS_COMPLETE = 1
ProjectRetention4.sql.je.gll=AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND PR.DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.IS_COMPLETE = 1
# Configuration for IS and BS by division
ProjectRetention4.sql.1.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	PR.AMOUNT AS DEBIT, 0 AS CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.2.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	PR.WT_AMOUNT AS DEBIT, 0 AS CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN WT_ACCOUNT_SETTING WTAS ON WTAS.WT_ACCOUNT_SETTING_ID = PR.WT_ACCOUNT_SETTING_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = WTAS.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.DIVISION_ID = PR.DIVISION_ID \
	AND PR.WT_ACCOUNT_SETTING_ID IS NOT NULL \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.3.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, PRL.AMOUNT AS CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_LINE PRL ON PRL.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	INNER JOIN AR_CUSTOMER_ACCOUNT ARC ON ARC.AR_CUSTOMER_ACCOUNT_ID = PR.AR_CUSTOMER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARC.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON PR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID 
ProjectRetention4.sql.4.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, COALESCE(PRL.VAT_AMOUNT, 0) as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_LINE PRL ON PRL.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	INNER JOIN VAT_ACCOUNT_SETUP VAS ON (VAS.COMPANY_ID = PR.COMPANY_ID AND VAS.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = VAS.OUTPUT_VAT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND VAS.TAX_TYPE_ID = PRL.TAX_TYPE_ID \
	AND PRL.TAX_TYPE_ID IN (1, 4, 5, 6, 8, 9) \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.5.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	ABS((SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
	WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0))) as DEBIT, 0 AS CREDIT, \
	A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND (SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
		WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
		GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0)) > 0 \
	AND PR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.6.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, ABS((SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
	WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
	GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0))) as CREDIT, \
	A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, PR.DATE AS DATE \
	FROM PROJECT_RETENTION PR \
	INNER JOIN PROJECT_RETENTION_ACCOUNT PRA ON (PRA.COMPANY_ID = PR.COMPANY_ID AND PRA.DIVISION_ID = PR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = PRA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = PR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND PR.PROJECT_RETENTION_TYPE_ID = 4 \
	AND (SELECT SUM(PRL1.UP_AMOUNT) FROM PROJECT_RETENTION_LINE PRL1 \
		WHERE PRL1.PROJECT_RETENTION_ID = PR.PROJECT_RETENTION_ID \
		GROUP BY PRL1.PROJECT_RETENTION_ID) - (PR.AMOUNT + COALESCE(PR.WT_AMOUNT, 0)) < 0 \
	AND PR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ProjectRetention4.sql.bs=AND PR.DATE <= IN_AS_OF_DATE \
	AND FW.IS_COMPLETE = 1
ProjectRetention4.sql.is=AND PR.DATE BETWEEN IN_DATE_FROM AND IN_DATE_TO \
	AND FW.IS_COMPLETE = 1