
#Description: Withdrawal Slip workflow and journal entries configuration

WithdrawalSlip.typeId=1
WithdrawalSlip.form=withdrawalSlip/viewForm
WithdrawalSlip.edit=withdrawal_slip_edit
WithdrawalSlip.print=withdrawalSlipPDF/pdf
WithdrawalSlip.service=eulap.eb.service.WithdrawalSlipService
WithdrawalSlip.oo.parent_to_child=1
WithdrawalSlip.oo.child_to_child=43
WithdrawalSlip.flow=1;2
WithdrawalSlip.1.statusId=1
WithdrawalSlip.1.required=
WithdrawalSlip.1.next=2
WithdrawalSlip.1.product_code=2015
WithdrawalSlip.1.module_code=8
WithdrawalSlip.2.statusId=3
WithdrawalSlip.2.required=1
WithdrawalSlip.2.next=0
WithdrawalSlip.2.product_code=2015
WithdrawalSlip.2.module_code=16
WithdrawalSlip.sql.entries=1;2;3
# WITHDRAWAL SLIP - CREDIT - ITEM CATEGORY
WithdrawalSlip.sql.1.je=SELECT * FROM ( \
	SELECT 'WITHDRAWAL SLIP' as SOURCE, WS.WITHDRAWAL_SLIP_ID as ID, C.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, \
	D.NUMBER as DIVISION_NO, D.NAME as DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, WS.DATE as GL_DATE, \
	CONCAT('WS ', WS.WS_NUMBER) as REFERENCE_NUMBER, WS.REMARKS as DESCRIPTION, \
	0 as DEBIT, COALESCE(UNIT_COST, 0) * QUANTITY as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM WITHDRAWAL_SLIP_ITEM WSI \
	INNER JOIN OBJECT_TO_OBJECT WS_OTO ON WS_OTO.TO_OBJECT_ID = WSI.EB_OBJECT_ID \
	INNER JOIN WITHDRAWAL_SLIP WS ON WS.EB_OBJECT_ID = WS_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT C_OTO ON C_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN COMPANY C ON C.EB_OBJECT_ID = C_OTO.FROM_OBJECT_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = WSI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON ICAS.ITEM_CATEGORY_ID = I.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON (AC.ACCOUNT_COMBINATION_ID = ICAS.INVENTORY_ACCOUNT \
		AND AC.COMPANY_ID = C.COMPANY_ID) \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = WS.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND WSI.ACTIVE = 1 \
	AND C.COMPANY_ID = IN_COMPANY_ID \
	GROUP BY WSI.EB_OBJECT_ID ) TBL
# WITHDRAWAL SLIP - DEBIT - CUSTOMER ACCOUNT/PROJECT
WithdrawalSlip.sql.2.je=SELECT * FROM ( \
	SELECT 'WITHDRAWAL SLIP' as SOURCE, WS.WITHDRAWAL_SLIP_ID as ID, C.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, \
	D.NUMBER as DIVISION_NO, D.NAME as DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, WS.DATE as GL_DATE, \
	CONCAT('WS ', WS.WS_NUMBER) as REFERENCE_NUMBER, WS.REMARKS as DESCRIPTION, \
	(COALESCE(UNIT_COST, 0) * QUANTITY) as DEBIT, 0 as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM WITHDRAWAL_SLIP_ITEM WSI \
	INNER JOIN OBJECT_TO_OBJECT WSI_OTO ON WSI_OTO.TO_OBJECT_ID = WSI.EB_OBJECT_ID \
	INNER JOIN WITHDRAWAL_SLIP WS ON WS.EB_OBJECT_ID = WSI_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT C_OTO ON C_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN COMPANY C ON C.EB_OBJECT_ID = C_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT CUST_OTO ON CUST_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN AR_CUSTOMER ARC ON ARC.EB_OBJECT_ID = CUST_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT CUT_ACCT_OTO ON CUT_ACCT_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN AR_CUSTOMER_ACCOUNT ACA ON ACA.AR_CUSTOMER_ID = ARC.AR_CUSTOMER_ID AND ACA.EB_OBJECT_ID = CUT_ACCT_OTO.FROM_OBJECT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = ACA.DEFAULT_WITHDRAWAL_SLIP_AC_ID AND AC.COMPANY_ID = C.COMPANY_ID) \
	INNER JOIN OBJECT_TO_OBJECT ACCT_OTO ON ACCT_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN ACCOUNT A ON A.EB_OBJECT_ID = ACCT_OTO.FROM_OBJECT_ID AND A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = WS.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND WSI.ACTIVE = 1 \
	AND C.COMPANY_ID =  IN_COMPANY_ID \
	GROUP BY WSI.EB_OBJECT_ID ) AS TBL
# WITHDRAWAL SLIP - DEBIT - FLEET
WithdrawalSlip.sql.3.je=SELECT * FROM ( \
	SELECT 'WITHDRAWAL SLIP' as SOURCE, WS.WITHDRAWAL_SLIP_ID as ID, C.COMPANY_ID, D.DIVISION_ID, A.ACCOUNT_ID, \
	D.NUMBER as DIVISION_NO, D.NAME as DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, WS.DATE as GL_DATE, \
	CONCAT('WS ', WS.WS_NUMBER) as REFERENCE_NUMBER, WS.REMARKS as DESCRIPTION, \
	(COALESCE(UNIT_COST, 0) * QUANTITY) as DEBIT, 0 as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM WITHDRAWAL_SLIP_ITEM WSI \
	INNER JOIN OBJECT_TO_OBJECT WSI_OTO ON WSI_OTO.TO_OBJECT_ID = WSI.EB_OBJECT_ID \
	INNER JOIN WITHDRAWAL_SLIP WS ON WS.EB_OBJECT_ID = WSI_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT C_OTO ON C_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN COMPANY C ON C.EB_OBJECT_ID = C_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT FP_OTO ON FP_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN FLEET_PROFILE FP ON FP.EB_OBJECT_ID = FP_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT D_OTO ON D_OTO.TO_OBJECT_ID = FP.EB_OBJECT_ID \
	INNER JOIN DIVISION D ON D.EB_OBJECT_ID = D_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT A_OTO ON A_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN ACCOUNT A ON A.EB_OBJECT_ID = A_OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = WS.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND WSI.ACTIVE = 1 \
	AND C.COMPANY_ID = IN_COMPANY_ID \
	GROUP BY WSI.EB_OBJECT_ID ) AS TBL
WithdrawalSlip.sql.je.jerr=WHERE GL_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN CONCAT('WS ', REFERENCE_NUMBER) LIKE IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER LIKE IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'WITHDRAWAL SLIP' THEN ID != 0 \
		WHEN 'ALL' THEN ID != 0 ELSE ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN IS_COMPLETE = IN_IS_POSTED ELSE IS_COMPLETE != IN_IS_POSTED END)
WithdrawalSlip.sql.je.ab=WHERE GL_DATE <= IN_AS_OF_DATE \
	AND IS_COMPLETE = 1
WithdrawalSlip.sql.je.aa=WHERE DIVISION_NO BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND ACCOUNT_ID = IN_ACCOUNT_ID \
	AND GL_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND DESCRIPTION LIKE IN_DESCRIPTION \
	AND IS_COMPLETE = 1
WithdrawalSlip.sql.inv.entries=1;2
# WITHDRAWAL SLIP - CUSTOMER ACCOUNT/PROJECT
WithdrawalSlip.sql.1.inv=SELECT 'WITHDRAWAL SLIP' AS SOURCE, W.WAREHOUSE_ID, WSI.ITEM_ID, I.STOCK_CODE, \
	I.DESCRIPTION AS DESCRIPTION, I.ITEM_CATEGORY_ID AS ITEM_CATEGORY_ID, I.UNIT_MEASUREMENT_ID as UNIT_MEASUREMENT_ID, \
	0 AS IN_QUANTITY, WSI.QUANTITY AS OUT_QUANTITY, 0 AS IN_UNIT_COST, WSI.UNIT_COST AS OUT_UNIT_COST, 0 AS IN_TOTAL_COST, \
	(WSI.UNIT_COST * WSI.QUANTITY) AS OUT_TOTAL_COST, WS.DATE AS DATE, WS.CREATED_DATE, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, I.ACTIVE, \
	CONCAT('WS ', WS.WS_NUMBER) AS REFERENCE_NUMBER, WS.PO_NUMBER AS INVOICE_NUMBER, ARC.NAME AS TRANS_DESCRIPTION, \
	ITS.SRP AS SRP, WS.EB_OBJECT_ID as PARENT_EB_OBJECT_ID, WSI.EB_OBJECT_ID as EB_OBJECT_ID \
	FROM WITHDRAWAL_SLIP_ITEM WSI \
	INNER JOIN ITEM I ON WSI.ITEM_ID = I.ITEM_ID \
	INNER JOIN OBJECT_TO_OBJECT WSI_OTO ON WSI_OTO.TO_OBJECT_ID = WSI.EB_OBJECT_ID \
	INNER JOIN WITHDRAWAL_SLIP WS ON WS.EB_OBJECT_ID = WSI_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT C_OTO ON C_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN COMPANY C ON C.EB_OBJECT_ID = C_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT WAREHOUSE_OTO ON WAREHOUSE_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN WAREHOUSE W ON W.EB_OBJECT_ID = WAREHOUSE_OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = WS.FORM_WORKFLOW_ID \
	INNER JOIN OBJECT_TO_OBJECT CUST_OTO ON CUST_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN AR_CUSTOMER ARC ON ARC.EB_OBJECT_ID = CUST_OTO.FROM_OBJECT_ID \
	INNER JOIN ITEM_SRP ITS ON WSI.ITEM_ID = ITS.ITEM_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 AND WSI.ACTIVE = 1 \
	AND ITS.ACTIVE = 1 \
	AND ITS.COMPANY_ID = C.COMPANY_ID \
	AND C.COMPANY_ID = IN_COMPANY_ID
# WITHDRAWAL SLIP - FLEET
WithdrawalSlip.sql.2.inv=SELECT 'WITHDRAWAL SLIP' AS SOURCE, W.WAREHOUSE_ID, WSI.ITEM_ID, I.STOCK_CODE, \
	I.DESCRIPTION AS DESCRIPTION, I.ITEM_CATEGORY_ID AS ITEM_CATEGORY_ID, I.UNIT_MEASUREMENT_ID as UNIT_MEASUREMENT_ID, \
	0 AS IN_QUANTITY, WSI.QUANTITY AS OUT_QUANTITY, 0 AS IN_UNIT_COST, WSI.UNIT_COST AS OUT_UNIT_COST, 0 AS IN_TOTAL_COST, \
	(WSI.UNIT_COST * WSI.QUANTITY) AS OUT_TOTAL_COST, WS.DATE AS DATE, WS.CREATED_DATE, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, I.ACTIVE, \
	CONCAT('WS ', WS.WS_NUMBER) AS REFERENCE_NUMBER, WS.PO_NUMBER AS INVOICE_NUMBER, FP.CODE_VESSEL_NAME AS TRANS_DESCRIPTION, \
	ITS.SRP AS SRP, WS.EB_OBJECT_ID as PARENT_EB_OBJECT_ID, WSI.EB_OBJECT_ID as EB_OBJECT_ID \
	FROM WITHDRAWAL_SLIP_ITEM WSI \
	INNER JOIN ITEM I ON WSI.ITEM_ID = I.ITEM_ID \
	INNER JOIN OBJECT_TO_OBJECT WSI_OTO ON WSI_OTO.TO_OBJECT_ID = WSI.EB_OBJECT_ID \
	INNER JOIN WITHDRAWAL_SLIP WS ON WS.EB_OBJECT_ID = WSI_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT C_OTO ON C_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN COMPANY C ON C.EB_OBJECT_ID = C_OTO.FROM_OBJECT_ID \
	INNER JOIN OBJECT_TO_OBJECT WAREHOUSE_OTO ON WAREHOUSE_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN WAREHOUSE W ON W.EB_OBJECT_ID = WAREHOUSE_OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = WS.FORM_WORKFLOW_ID \
	INNER JOIN OBJECT_TO_OBJECT FP_OTO ON FP_OTO.TO_OBJECT_ID = WS.EB_OBJECT_ID \
	INNER JOIN FLEET_PROFILE FP ON FP.EB_OBJECT_ID = FP_OTO.FROM_OBJECT_ID \
	INNER JOIN ITEM_SRP ITS ON WSI.ITEM_ID = ITS.ITEM_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 AND WSI.ACTIVE = 1 \
	AND ITS.ACTIVE = 1 \
	AND ITS.COMPANY_ID = C.COMPANY_ID \
	AND C.COMPANY_ID = IN_COMPANY_ID
WithdrawalSlip.sql.inv.as=AND FW.IS_COMPLETE = 1 \
	AND WSI.ITEM_ID = IN_ITEM_ID \
	AND W.WAREHOUSE_ID = IN_WAREHOUSE_ID \
	AND WS.DATE <= IN_DATE
WithdrawalSlip.sql.inv.rsf=AND FW.IS_COMPLETE = 1 \
	AND WSI.ITEM_ID = IN_ITEM_ID \
	AND W.WAREHOUSE_ID = IN_WAREHOUSE_ID \
	AND WS.DATE > IN_DATE
WithdrawalSlip.sql.inv.il=AND WS.DATE <= IN_DATE \
	AND IF(IN_ITEM_CATEGORY_ID != -1, I.ITEM_CATEGORY_ID = IN_ITEM_CATEGORY_ID, I.ITEM_CATEGORY_ID != 0) \
	AND IF(IN_WAREHOUSE_ID != -1, W.WAREHOUSE_ID = IN_WAREHOUSE_ID, W.WAREHOUSE_ID != IN_WAREHOUSE_ID) \
	AND IF(IN_IS_ACTIVE != -1, I.ACTIVE = IN_IS_ACTIVE, I.ACTIVE != IN_IS_ACTIVE ) \
	AND CASE WHEN IN_STATUS = -1 THEN FW.CURRENT_STATUS_ID != 4 WHEN IN_STATUS = 1 THEN FW.IS_COMPLETE = 1 END
WithdrawalSlip.sql.inv.sc=AND FW.IS_COMPLETE = 1 \
	AND WSI.ITEM_ID = IN_ITEM_ID \
	AND W.WAREHOUSE_ID = IN_WAREHOUSE_ID \
	AND WS.DATE BETWEEN IN_START_DATE AND IN_END_DATE
WithdrawalSlip.sql.inv.ft=AND FW.IS_COMPLETE = 1 \
	AND WSI.ITEM_ID = IN_ITEM_ID \
	AND W.WAREHOUSE_ID = IN_WAREHOUSE_ID \
	AND WS.DATE > IN_AS_OF_DATE