#-- Customer Advance Payment - IS configuration.

CustomerAdvancePayment3.typeId=1
CustomerAdvancePayment3.form=customerAdvancePayment/3/viewForm
CustomerAdvancePayment3.edit=customer_advance_payment_is_edit
CustomerAdvancePayment3.print=customerAdvancePaymentPDF
CustomerAdvancePayment3.service=eulap.eb.service.CustomerAdvancePaymentService
CustomerAdvancePayment3.oo.parent_to_child=1
CustomerAdvancePayment3.oo.child_to_child=11
CustomerAdvancePayment3.acct_transaction_types=1
CustomerAdvancePayment3.flow=1;2
CustomerAdvancePayment3.1.statusId=1
CustomerAdvancePayment3.1.required=
CustomerAdvancePayment3.1.next=2
CustomerAdvancePayment3.1.product_code=252
CustomerAdvancePayment3.1.module_code=8
CustomerAdvancePayment3.2.statusId=7
CustomerAdvancePayment3.2.required=1
CustomerAdvancePayment3.2.next=0
CustomerAdvancePayment3.2.product_code=252
CustomerAdvancePayment3.2.module_code=16
CustomerAdvancePayment3.sql.entries=1;2;3;4;5;6
#Customer Advance Payment - Receipt Method Debit - Default Debit
CustomerAdvancePayment3.sql.1.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	AMOUNT as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CUSTOMER_ADVANCE_PAYMENT_ITEM CAPI \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAPI.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = RM.DEBIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Customer Advance Payment - Receipt Method Debit - Default Debit - Other Charges
CustomerAdvancePayment3.sql.2.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	CASE WHEN CAL.AMOUNT >= 0 THEN CAL.AMOUNT ELSE 0 END as DEBIT, \
	CASE WHEN CAL.AMOUNT < 0 THEN ABS(CAL.AMOUNT) ELSE 0 END as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_AR_LINE CAL \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAL.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = RM.DEBIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Customer Advance Payment - Receipt Method Debit - Bank Account
CustomerAdvancePayment3.sql.3.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	AMOUNT as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CUSTOMER_ADVANCE_PAYMENT_ITEM CAPI \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAPI.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID = RM.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Customer Advance Payment - Receipt Method Debit - Bank Account - Other Charges
CustomerAdvancePayment3.sql.4.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	CASE WHEN CAL.AMOUNT >= 0 THEN CAL.AMOUNT ELSE 0 END as DEBIT, \
	CASE WHEN CAL.AMOUNT < 0 THEN ABS(CAL.AMOUNT) ELSE 0 END as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_AR_LINE CAL \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAL.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID = RM.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Customer Advance Payment - Receipt Method Credit
CustomerAdvancePayment3.sql.5.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	0 as DEBIT, AMOUNT as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CUSTOMER_ADVANCE_PAYMENT_ITEM CAPI \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAPI.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = RM.CREDIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Customer Advance Payment - Receipt Method Credit - Other Charges
CustomerAdvancePayment3.sql.6.je=SELECT 'CUSTOMER ADVANCE PAYMENT - IS' as SOURCE, CAP.CUSTOMER_ADVANCE_PAYMENT_ID as ID, \
	AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, CAP.RECEIPT_DATE as GL_DATE, \
	CONCAT('CAP-IS', CAP_NUMBER) as REFERENCE_NUMBER, CAP.SALE_INVOICE_NO AS DESCRIPTION, \
	CASE WHEN CAL.AMOUNT < 0 THEN ABS(CAL.AMOUNT) ELSE 0 END as DEBIT, \
	CASE WHEN CAL.AMOUNT >= 0 THEN CAL.AMOUNT ELSE 0 END as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_AR_LINE CAL \
	INNER JOIN CUSTOMER_ADVANCE_PAYMENT CAP ON CAP.CUSTOMER_ADVANCE_PAYMENT_ID = CAL.CUSTOMER_ADVANCE_PAYMENT_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAP.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
		(AC.ACCOUNT_COMBINATION_ID = RM.CREDIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAP.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAP.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 3 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
CustomerAdvancePayment3.sql.je.jerr=AND CAP.RECEIPT_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN CONCAT('CAP-IS', CAP.CAP_NUMBER) like IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER like IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'CUSTOMER ADVANCE PAYMENT - IS' THEN CAP.CUSTOMER_ADVANCE_PAYMENT_ID != 0 \
		WHEN 'ALL' THEN CAP.CUSTOMER_ADVANCE_PAYMENT_ID != 0 \
		ELSE CAP.CUSTOMER_ADVANCE_PAYMENT_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN FW.IS_COMPLETE = IN_IS_POSTED ELSE FW.IS_COMPLETE != IN_IS_POSTED END)
CustomerAdvancePayment3.sql.je.ab=AND CAP.RECEIPT_DATE <= IN_AS_OF_DATE \
	AND FW.IS_COMPLETE = 1
CustomerAdvancePayment3.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND CAP.RECEIPT_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND CAP.SALE_INVOICE_NO LIKE IN_DESCRIPTION \
	AND FW.IS_COMPLETE = 1
CustomerAdvancePayment3.sql.je.gll=AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND CAP.RECEIPT_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.IS_COMPLETE = 1