
#-- AP Payment - NSB 4 configuration.

ApPayment3.typeId=1
ApPayment3.form=apPayment/3/form/viewForm
ApPayment3.edit=ap_payment_nsb4_edit
ApPayment3.print=checkVoucher/3/pdf
ApPayment3.service=eulap.eb.service.ApPaymentService
ApPayment3.oo.parent_to_child=1
ApPayment3.oo.child_to_child=24004
ApPayment3.flow=1;2;3;4;5
ApPayment3.1.statusId=1
ApPayment3.1.required=
ApPayment3.1.next=2;5
ApPayment3.1.product_code=24036
ApPayment3.1.module_code=8
ApPayment3.2.statusId=30
ApPayment3.2.required=1
ApPayment3.2.next=3;5
ApPayment3.2.product_code=24036
ApPayment3.2.module_code=16
ApPayment3.3.statusId=10
ApPayment3.3.required=2
ApPayment3.3.next=4;5
ApPayment3.3.product_code=24036
ApPayment3.3.module_code=32
ApPayment3.4.statusId=16
ApPayment3.4.required=3
ApPayment3.4.next=0
ApPayment3.4.product_code=24036
ApPayment3.4.module_code=64
ApPayment3.5.statusId=32
ApPayment3.5.required=
ApPayment3.5.next=0
ApPayment3.5.product_code=24036
ApPayment3.5.module_code=128
ApPayment3.sql.entries=1;2;3;4;5;6
# Accounts Payable - Debit
ApPayment3.sql.1.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AI.AP_PAYMENT_LINE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AP.CHECK_DATE as GL_DATE, \
	CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, \
	CONCAT (CASE WHEN API.INVOICE_TYPE_ID IN (6, 31, 32, 33, 34, 35, 36) THEN CONCAT('RTS', CAST(API.SEQUENCE_NO AS CHAR(10))) \
	WHEN API.INVOICE_TYPE_ID >= 19 AND API.INVOICE_TYPE_ID <= 24 THEN CONCAT('API NPO - ', CAST(API.SEQUENCE_NO AS CHAR(10))) \
	WHEN API.INVOICE_TYPE_ID >= 25 AND API.INVOICE_TYPE_ID <= 30 THEN CONCAT('API G/S - ', CAST(API.SEQUENCE_NO AS CHAR(10))) \
	ELSE API.INVOICE_NUMBER END) AS DESCRIPTION, \
	IF(AI.PAID_AMOUNT > 0, AI.PAID_AMOUNT, 0) AS DEBIT, IF(AI.PAID_AMOUNT < 0, ABS(AI.PAID_AMOUNT), 0) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ACCOUNT SA ON SA.SUPPLIER_ACCOUNT_ID = AP.SUPPLIER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SA.DEFAULT_CREDIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN AP_INVOICE API ON API.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Cash in Bank - Credit
ApPayment3.sql.2.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AP.AP_PAYMENT_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AP.CHECK_DATE as GL_DATE, CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, \
	"" AS DESCRIPTION, 0 AS DEBIT, COALESCE(AP.AMOUNT, 0) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT AP \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID=AP.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND AP.AMOUNT != 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Advances to Supplier - Credit
ApPayment3.sql.3.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AI.AP_PAYMENT_LINE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AP.CHECK_DATE as GL_DATE, CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, \
	CONCAT('SAP - ', SAP.SEQUENCE_NO) AS DESCRIPTION, 0 AS DEBIT, COALESCE(-AI.PAID_AMOUNT, 0) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ADV_PAYMENT_ACCOUNT SAPA ON (SAPA.COMPANY_ID = AP.COMPANY_ID AND SAPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SAPA.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN SUPPLIER_ADVANCE_PAYMENT SAP ON SAP.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND AI.PAID_AMOUNT < 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Advances to Supplier - Debit
ApPayment3.sql.4.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AI.AP_PAYMENT_LINE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AP.CHECK_DATE as GL_DATE, CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, \
	CONCAT('SAP - ', SAP.SEQUENCE_NO) AS DESCRIPTION, AI.PAID_AMOUNT AS DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ACCOUNT SA ON SA.SUPPLIER_ACCOUNT_ID = AP.SUPPLIER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SA.DEFAULT_CREDIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN SUPPLIER_ADVANCE_PAYMENT SAP ON SAP.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND AI.PAID_AMOUNT > 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Gain
ApPayment3.sql.5.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AP.AP_PAYMENT_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, \
	AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, \
	AP.CHECK_DATE as GL_DATE, CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, '' AS DESCRIPTION, 0 AS DEBIT, \
	ABS(COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
	WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) AS CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT AP \
	INNER JOIN AP_PAYMENT_ACCOUNT APPA ON (APPA.COMPANY_ID = AP.COMPANY_ID AND APPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = APPA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND (COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
		WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) > 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = IN_COMPANY_ID
# Loss
ApPayment3.sql.6.je=SELECT 'AP PAYMENT - NSB 4' as SOURCE, AP.AP_PAYMENT_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, \
	AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, \
	AP.CHECK_DATE as GL_DATE, CONCAT(AP.CHECK_NUMBER, '') as REFERENCE_NUMBER, '' AS DESCRIPTION, \
	ABS(COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
	WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) AS DEBIT, \
	0 AS CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, IF(FW.CURRENT_STATUS_ID != 1, 1, 0) AS IS_POSTED, \
	'' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_PAYMENT AP \
	INNER JOIN AP_PAYMENT_ACCOUNT APPA ON (APPA.COMPANY_ID = AP.COMPANY_ID AND APPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = APPA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (4, 32) \
	AND (COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
		WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) < 0 \
	AND AP.DIVISION_ID = 3 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ApPayment3.sql.je.jerr=AND AP.CHECK_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN AP.CHECK_NUMBER LIKE IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER LIKE IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'AP PAYMENT - NSB 4' THEN AP.AP_PAYMENT_ID != 0 \
		WHEN 'ALL' THEN AP.AP_PAYMENT_ID != 0 ELSE AP.AP_PAYMENT_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN IF(IN_IS_POSTED = 1, FW.CURRENT_STATUS_ID NOT IN (1, 4, 32), FW.CURRENT_STATUS_ID = 1) \
		ELSE FW.CURRENT_STATUS_ID NOT IN (4, 32) END)
ApPayment3.sql.je.ab=AND IF(DATE_FROM IS NOT NULL, AP.CHECK_DATE BETWEEN DATE_FROM AND DATE_TO, AP.CHECK_DATE <= DATE_TO) \
	AND IF(IN_DIVISION_ID != -1, AP.DIVISION_ID = IN_DIVISION_ID, AP.DIVISION_ID != IN_DIVISION_ID) \
	AND FW.CURRENT_STATUS_ID != 1
ApPayment3.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AP.CHECK_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.CURRENT_STATUS_ID != 1
ApPayment3.sql.je.gll=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AP.CHECK_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.CURRENT_STATUS_ID != 1
# Configuration for IS and BS by division
# Accounts Payable - Debit
ApPayment3.sql.1.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	IF(AI.PAID_AMOUNT > 0, AI.PAID_AMOUNT, 0) AS DEBIT, IF(AI.PAID_AMOUNT < 0, ABS(AI.PAID_AMOUNT), 0) as CREDIT, \
	A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ACCOUNT SA ON SA.SUPPLIER_ACCOUNT_ID = AP.SUPPLIER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SA.DEFAULT_CREDIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN AP_INVOICE API ON API.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Cash in Bank - Credit
ApPayment3.sql.2.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, COALESCE(AP.AMOUNT, 0) as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT AP \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID=AP.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND AP.AMOUNT != 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Advances to Supplier - Credit
ApPayment3.sql.3.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, COALESCE(-AI.PAID_AMOUNT, 0) as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ADV_PAYMENT_ACCOUNT SAPA ON (SAPA.COMPANY_ID = AP.COMPANY_ID AND SAPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SAPA.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN SUPPLIER_ADVANCE_PAYMENT SAP ON SAP.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND AI.PAID_AMOUNT < 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Advances to Supplier - Debit
ApPayment3.sql.4.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	AI.PAID_AMOUNT AS DEBIT, 0 as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT_LINE AI \
	INNER JOIN AP_PAYMENT AP ON AP.AP_PAYMENT_ID = AI.AP_PAYMENT_ID \
	INNER JOIN SUPPLIER_ACCOUNT SA ON SA.SUPPLIER_ACCOUNT_ID = AP.SUPPLIER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = SA.DEFAULT_CREDIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN OBJECT_TO_OBJECT OTO ON (OTO.TO_OBJECT_ID = AI.EB_OBJECT_ID AND OTO.OR_TYPE_ID = 24004) \
	INNER JOIN SUPPLIER_ADVANCE_PAYMENT SAP ON SAP.EB_OBJECT_ID = OTO.FROM_OBJECT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND AI.PAID_AMOUNT > 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Gain
ApPayment3.sql.5.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, ABS(COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID \
	GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) AS CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT AP \
	INNER JOIN AP_PAYMENT_ACCOUNT APPA ON (APPA.COMPANY_ID = AP.COMPANY_ID AND APPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = APPA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND (COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
		WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) > 0 \
	AND AP.DIVISION_ID = 3 \
	AND AP.COMPANY_ID = IN_COMPANY_ID
# Loss
ApPayment3.sql.6.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	ABS(COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID \
	GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) AS DEBIT, 0 AS CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AP.CHECK_DATE AS DATE \
	FROM AP_PAYMENT AP \
	INNER JOIN AP_PAYMENT_ACCOUNT APPA ON (APPA.COMPANY_ID = AP.COMPANY_ID AND APPA.DIVISION_ID = AP.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = APPA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AP.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID NOT IN (1, 4, 32) \
	AND (COALESCE((SELECT SUM(APL.PAID_AMOUNT) FROM AP_PAYMENT_LINE APL \
		WHERE APL.AP_PAYMENT_ID = AP.AP_PAYMENT_ID GROUP BY AP.AP_PAYMENT_ID), 0) - AP.AMOUNT) < 0 \
	AND AP.DIVISION_ID = 3 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
ApPayment3.sql.bs=AND AP.CHECK_DATE <= IN_AS_OF_DATE
ApPayment3.sql.is=AND AP.CHECK_DATE BETWEEN IN_DATE_FROM AND IN_DATE_TO