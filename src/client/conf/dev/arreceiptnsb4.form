
#-- Description: AR Receipt - NSB 4 configuration.

ArReceipt3.typeId=1
ArReceipt3.form=arReceipt/3/form/viewForm
ArReceipt3.edit=ar_receipt_nsb4_edit
ArReceipt3.print=arReceiptPrint/pdf
ArReceipt3.service=eulap.eb.service.ArReceiptService
ArReceipt3.acct_transaction_types=1
ArReceipt3.oo.parent_to_child=1
ArReceipt3.oo.child_to_child=24006
ArReceipt3.flow=1;2;3
ArReceipt3.1.statusId=7
ArReceipt3.1.required=
ArReceipt3.1.next=2
ArReceipt3.1.product_code=24092
ArReceipt3.1.module_code=8
ArReceipt3.2.statusId=15
ArReceipt3.2.required=1
ArReceipt3.2.next=3
ArReceipt3.2.product_code=24092
ArReceipt3.2.module_code=16
ArReceipt3.3.statusId=16
ArReceipt3.3.required=2
ArReceipt3.3.next=0
ArReceipt3.3.product_code=24092
ArReceipt3.3.module_code=32
ArReceipt3.sql.entries=1;2;3;4;5;6;7
# Debit - RM default debit
ArReceipt3.sql.1.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' as DESCRIPTION, AR.AMOUNT AS DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = AR.RECEIPT_METHOD_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = RM.DEBIT_ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND RM.DEBIT_ACCOUNT_COMBINATION_ID IS NOT NULL \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Debit - RM bank account
ArReceipt3.sql.2.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' AS DESCRIPTION, AR.AMOUNT AS DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = AR.RECEIPT_METHOD_ID \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID = RM.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Credit - RM credit account
ArReceipt3.sql.3.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' AS DESCRIPTION, 0 AS DEBIT, ARL.AMOUNT as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_LINE ARL ON ARL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID \
	INNER JOIN AR_CUSTOMER_ACCOUNT ACA ON ACA.AR_CUSTOMER_ACCOUNT_ID = AR.AR_CUSTOMER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ACA.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Recoupment
ArReceipt3.sql.4.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' as DESCRIPTION, AR.RECOUPMENT AS DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.RECOUPMENT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.RECOUPMENT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Retention
ArReceipt3.sql.5.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' as DESCRIPTION, AR.RETENTION AS DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.RETENTION_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.RETENTION != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Loss
ArReceipt3.sql.6.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, '' AS DESCRIPTION, \
	COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
	- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0) as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = AR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND (COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
		- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) > 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Gain
ArReceipt3.sql.7.je=SELECT 'ACCOUNT COLLECTION - NSB 4' as SOURCE, AR.AR_RECEIPT_ID as ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AR.MATURITY_DATE as GL_DATE, AR.RECEIPT_NUMBER as REFERENCE_NUMBER, \
	'' AS DESCRIPTION, 0 AS DEBIT,  \
	ABS(COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
	- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, 1 as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = AR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND (COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
		- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) < 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = IN_COMPANY_ID
ArReceipt3.sql.je.jerr=AND AR.MATURITY_DATE BETWEEN DATE_FROM and DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN AR.RECEIPT_NUMBER like IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER like IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'ACCOUNT COLLECTION - NSB 4' THEN AR.AR_RECEIPT_ID != 0 \
		WHEN 'ALL' THEN AR.AR_RECEIPT_ID != 0 \
		ELSE AR.AR_RECEIPT_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN IF(IN_IS_POSTED = 1, FW.CURRENT_STATUS_ID != 4, FW.CURRENT_STATUS_ID = 0) ELSE FW.CURRENT_STATUS_ID != 4 END) 
ArReceipt3.sql.je.ab=AND IF(DATE_FROM IS NOT NULL, AR.MATURITY_DATE BETWEEN DATE_FROM AND DATE_TO, AR.MATURITY_DATE <= DATE_TO) \
	AND IF(IN_DIVISION_ID != -1, AR.DIVISION_ID = IN_DIVISION_ID, AR.DIVISION_ID != IN_DIVISION_ID)
ArReceipt3.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AR.MATURITY_DATE BETWEEN DATE_FROM AND DATE_TO
ArReceipt3.sql.je.gll=AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AR.MATURITY_DATE BETWEEN DATE_FROM AND DATE_TO
# Configuration for IS and BS by division
# Debit - RM default debit
ArReceipt3.sql.1.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	AR.AMOUNT AS DEBIT, 0 as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = AR.RECEIPT_METHOD_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = RM.DEBIT_ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND RM.DEBIT_ACCOUNT_COMBINATION_ID IS NOT NULL \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Debit - RM bank account
ArReceipt3.sql.2.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	AR.AMOUNT AS DEBIT, 0 as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = AR.RECEIPT_METHOD_ID \
	INNER JOIN BANK_ACCOUNT BA ON BA.BANK_ACCOUNT_ID = RM.BANK_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = BA.CASH_IN_BANK_ACCT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Credit - RM credit account
ArReceipt3.sql.3.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, ARL.AMOUNT as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_LINE ARL ON ARL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID \
	INNER JOIN AR_CUSTOMER_ACCOUNT ACA ON ACA.AR_CUSTOMER_ACCOUNT_ID = AR.AR_CUSTOMER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ACA.DEFAULT_DEBIT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Recoupment
ArReceipt3.sql.4.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	AR.RECOUPMENT AS DEBIT, 0 as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.RECOUPMENT_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.RECOUPMENT != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Retention
ArReceipt3.sql.5.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	AR.RETENTION AS DEBIT, 0 as CREDIT, A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.RETENTION_AC_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AR.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.RETENTION != 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = AC.COMPANY_ID \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Loss
ArReceipt3.sql.6.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
	- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0) as DEBIT, 0 as CREDIT, \
	A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.FOREIGN_EXCHANGE_LOSS_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = AR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND (COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
		- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) > 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = IN_COMPANY_ID
# Foreign Exchange Gain
ArReceipt3.sql.7.isbs=SELECT AC.COMPANY_ID, D.NAME AS DIVISION_NAME, D.DIVISION_ID, A.ACCOUNT_NAME, A.ACCOUNT_ID, A.PARENT_ACCOUNT_ID, \
	0 AS DEBIT, ABS(COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
	- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) as CREDIT, \
	A.ACCOUNT_TYPE_ID, A.NUMBER as ACCT_NO, AR.MATURITY_DATE AS DATE \
	FROM AR_RECEIPT AR \
	INNER JOIN AR_RECEIPT_ACCOUNT ARRA ON (ARRA.COMPANY_ID = AR.COMPANY_ID AND ARRA.DIVISION_ID = AR.DIVISION_ID) \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ARRA.FOREIGN_EXCHANGE_GAIN_AC_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN FORM_WORKFLOW FW ON FW.FORM_WORKFLOW_ID = AR.FORM_WORKFLOW_ID \
	WHERE FW.CURRENT_STATUS_ID != 4 \
	AND AR.AMOUNT != 0 \
	AND (COALESCE((SELECT SUM(ARRL.AMOUNT) FROM AR_RECEIPT_LINE ARRL WHERE ARRL.AR_RECEIPT_ID = AR.AR_RECEIPT_ID), 0) \
		- AR.AMOUNT - COALESCE(AR.RECOUPMENT, 0) - COALESCE(AR.RETENTION, 0)) < 0 \
	AND AR.DIVISION_ID = 3 \
	AND AR.COMPANY_ID = IN_COMPANY_ID
ArReceipt3.sql.bs=AND AR.MATURITY_DATE <= IN_AS_OF_DATE
ArReceipt3.sql.is=AND AR.MATURITY_DATE BETWEEN IN_DATE_FROM AND IN_DATE_TO