
# Description: Paid in Advance Delivery WIPSO workfow and journal entries configuration

CAPDelivery5.typeId=1
CAPDelivery5.form=capDeliveryWipso/viewForm
CAPDelivery5.edit=cap_delivery_wipso_edit
CAPDelivery5.print=capDeliveryWipso/printOut
CAPDelivery5.service=eulap.eb.service.CAPDeliveryWipsoService
CAPDelivery5.oo.parent_to_child=1
CAPDelivery5.oo.child_to_child=12
CAPDelivery5.flow=1;2
CAPDelivery5.1.statusId=1
CAPDelivery5.1.required=
CAPDelivery5.1.next=2
CAPDelivery5.1.product_code=2011
CAPDelivery5.1.module_code=8
CAPDelivery5.2.statusId=17
CAPDelivery5.2.required=1
CAPDelivery5.2.next=0
CAPDelivery5.2.product_code=2011
CAPDelivery5.2.module_code=16
CAPDelivery5.sql.entries=1;2;3;4;5;6;7
#Paid in Advance Delivery - WIPSO - DEBIT - Cost Account
CAPDelivery5.sql.1.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	COALESCE(CAPDI.UNIT_COST, 0) * CAPDI.QUANTITY as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_ITEM CAPDI \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CAPDI.CAP_DELIVERY_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = CAPDI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON I.ITEM_CATEGORY_ID = ICAS.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = ICAS.COST_ACCOUNT AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - CREDIT - Inventory Account
CAPDelivery5.sql.2.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	0 as DEBIT, COALESCE(CAPDI.UNIT_COST, 0) * CAPDI.QUANTITY as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_ITEM CAPDI \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CAPDI.CAP_DELIVERY_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = CAPDI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON I.ITEM_CATEGORY_ID = ICAS.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = ICAS.INVENTORY_ACCOUNT AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - CREDIT - Sales Account
CAPDelivery5.sql.3.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	0 as DEBIT, CAPDI.QUANTITY * CAPDI.SRP as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_ITEM CAPDI \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CAPDI.CAP_DELIVERY_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = CAPDI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON I.ITEM_CATEGORY_ID = ICAS.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = ICAS.SALES_ACCOUNT AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - CREDIT - Sales Discount Account
CAPDelivery5.sql.4.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	0 as DEBIT, -COALESCE(DISCOUNT, 0) as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_ITEM CAPDI \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CAPDI.CAP_DELIVERY_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = CAPDI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON I.ITEM_CATEGORY_ID = ICAS.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = ICAS.SALES_DISCOUNT_ACCOUNT AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND (DISCOUNT IS NOT NULL || DISCOUNT != 0) \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - DEBIT - Receipt Method - CAP
CAPDelivery5.sql.5.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	CAPDI.AMOUNT as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_ITEM CAPDI \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CAPDI.CAP_DELIVERY_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = CAPDI.ITEM_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAPD.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = RM.CREDIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE IA.ACTIVE = 1 \
	AND IA.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - DEBIT - Receipt Method - CAP - Other Charges
CAPDelivery5.sql.6.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	CPAL.AMOUNT as DEBIT, 0 as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_AR_LINE CPAL \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CPAL.CAP_DELIVERY_ID \
	INNER JOIN INVENTORY_ACCOUNT IA ON IA.COMPANY_ID = CAPD.COMPANY_ID \
	INNER JOIN RECEIPT_METHOD RM ON RM.RECEIPT_METHOD_ID = IA.CUSTOMER_ADV_PAYMENT_RM_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON  \
	(AC.ACCOUNT_COMBINATION_ID = RM.CREDIT_ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE IA.ACTIVE = 1 \
	AND IA.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
#Paid in Advance Delivery - WIPSO - Other Charges
CAPDelivery5.sql.7.je=SELECT 'PAID IN ADVANCE DELIVERY - WIPSO' AS SOURCE, CAPD.CAP_DELIVERY_ID AS ID, AC.COMPANY_ID, \
	AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, A.NUMBER as ACCT_NO, \
	A.ACCOUNT_NAME, CAPD.DELIVERY_DATE AS GL_DATE, \
	CONCAT('PIAD-WIPSO ', CAST(CAPD.CAPD_NUMBER AS CHAR(20))) as REFERENCE_NUMBER, CAPD.SALES_INVOICE_NO AS DESCRIPTION, \
	CASE WHEN CPAL.AMOUNT < 0 THEN ABS(CPAL.AMOUNT) ELSE 0 END as DEBIT, \
	CASE WHEN CPAL.AMOUNT >= 0 THEN CPAL.AMOUNT ELSE 0 END as CREDIT, \
	FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM CAP_DELIVERY_AR_LINE CPAL \
	INNER JOIN CAP_DELIVERY CAPD ON CAPD.CAP_DELIVERY_ID = CPAL.CAP_DELIVERY_ID \
	INNER JOIN AR_LINE_SETUP ALS ON ALS.AR_LINE_SETUP_ID = CPAL.AR_LINE_SETUP_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON  \
	(AC.ACCOUNT_COMBINATION_ID = ALS.ACCOUNT_COMBINATION_ID AND AC.COMPANY_ID = CAPD.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON CAPD.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE CAPD.COMPANY_ID = AC.COMPANY_ID \
	AND FW.CURRENT_STATUS_ID != 4  \
	AND CAPD.CUSTOMER_ADVANCE_PAYMENT_TYPE_ID = 5 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
CAPDelivery5.sql.je.jerr=AND CAPD.DELIVERY_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN CONCAT('PIAD-WIPSO', CAPD.CAPD_NUMBER) like IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER like IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'PAID IN ADVANCE DELIVERY - WIPSO' THEN CAPD.CAP_DELIVERY_ID != 0 \
		WHEN 'ALL' THEN CAPD.CAP_DELIVERY_ID != 0 \
		ELSE CAPD.CAP_DELIVERY_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN FW.IS_COMPLETE = IN_IS_POSTED ELSE FW.IS_COMPLETE != IN_IS_POSTED END)
CAPDelivery5.sql.je.ab=AND CAPD.DELIVERY_DATE <= IN_AS_OF_DATE \
	AND FW.IS_COMPLETE = 1
CAPDelivery5.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND CAPD.DELIVERY_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND CAPD.SALES_INVOICE_NO LIKE IN_DESCRIPTION \
	AND FW.IS_COMPLETE = 1
CAPDelivery5.sql.je.gll=AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND CAPD.DELIVERY_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.IS_COMPLETE = 1