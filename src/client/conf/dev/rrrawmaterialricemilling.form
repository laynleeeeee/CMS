
# Description: Receiving Report - Raw Materials workfow and journal entries configuration

APInvoice8.typeId=1
APInvoice8.form=rrRawMaterial/view
APInvoice8.edit=rr_raw_material_edit
APInvoice8.print=rrRawMaterial/scaleSheetRpt
APInvoice8.service=eulap.eb.service.RrRawMaterialService
APInvoice8.acct_transaction_types=2
APInvoice8.oo.parent_to_child=1
APInvoice8.flow=1;2
APInvoice8.1.statusId=1
APInvoice8.1.required=
APInvoice8.1.next=2
APInvoice8.1.product_code=234
APInvoice8.1.module_code=8
APInvoice8.2.statusId=8
APInvoice8.2.required=1
APInvoice8.2.next=0
APInvoice8.2.product_code=234
APInvoice8.2.module_code=16
APInvoice8.sql.entries=1;2;3;4
# -- Receiving Report - Raw Materials - Debit - Item Category Account Setup
APInvoice8.sql.1.je=SELECT 'RECEIVING REPORT - RM' as SOURCE, AI.AP_INVOICE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AI.GL_DATE, CONCAT('RR-RM ', AI.SEQUENCE_NO) as REFERENCE_NUMBER, COALESCE(AI.INVOICE_NUMBER, ', ', RR.DELIVERY_RECEIPT_NO) as DESCRIPTION, \
	RRI.UNIT_COST * (COALESCE((SELECT SUM(RRBQ.NET_WEIGHT) FROM RRI_BAG_QUANTITY RRBQ INNER JOIN OBJECT_TO_OBJECT OTO ON OTO.TO_OBJECT_ID = RRBQ.EB_OBJECT_ID \
	WHERE RRBQ.ACTIVE = 1 AND OTO.FROM_OBJECT_ID = AI.EB_OBJECT_ID), 0) - COALESCE((SELECT SUM(RRBD.BAG_QUANTITY * RRBD.DISCOUNT_QUANTITY) FROM RRI_BAG_DISCOUNT RRBD \
	INNER JOIN OBJECT_TO_OBJECT OTO ON OTO.TO_OBJECT_ID = RRBD.EB_OBJECT_ID WHERE RRBD.ACTIVE = 1 AND OTO.FROM_OBJECT_ID = AI.EB_OBJECT_ID), 0)) as DEBIT, \
	0 as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM R_RECEIVING_REPORT_ITEM RRI \
	INNER JOIN R_RECEIVING_REPORT_RM_ITEM RRMI ON RRMI.R_RECEIVING_REPORT_ITEM_ID = RRI.R_RECEIVING_REPORT_ITEM_ID \
	INNER JOIN R_RECEIVING_REPORT RR ON RR.AP_INVOICE_ID = RRI.AP_INVOICE_ID \
	INNER JOIN AP_INVOICE AI ON AI.AP_INVOICE_ID = RRI.AP_INVOICE_ID \
	INNER JOIN ITEM I ON I.ITEM_ID = RRI.ITEM_ID \
	INNER JOIN ITEM_CATEGORY_ACCOUNT_SETUP ICAS ON I.ITEM_CATEGORY_ID = ICAS.ITEM_CATEGORY_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = ICAS.INVENTORY_ACCOUNT AND AC.COMPANY_ID = RR.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AI.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE ICAS.COMPANY_ID = AC.COMPANY_ID \
	AND AI.INVOICE_TYPE_ID = 8 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# -- Receiving Report - RM - Debit - AP Line Setup (Positive)
APInvoice8.sql.2.je=SELECT 'RECEIVING REPORT - RM' as SOURCE, AI.AP_INVOICE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AI.GL_DATE as GL_DATE, CONCAT('RR-RM ', AI.SEQUENCE_NO) as REFERENCE_NUMBER, COALESCE(AI.INVOICE_NUMBER, ', ', RR.DELIVERY_RECEIPT_NO) AS DESCRIPTION, \
	APL.AMOUNT AS DEBIT, 0 as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_INVOICE_LINE APL \
	INNER JOIN AP_INVOICE AI ON AI.AP_INVOICE_ID = APL.AP_INVOICE_ID \
	INNER JOIN R_RECEIVING_REPORT RR ON RR.AP_INVOICE_ID = APL.AP_INVOICE_ID \
	INNER JOIN AP_LINE_SETUP ALS ON ALS.AP_LINE_SETUP_ID = APL.AP_LINE_SETUP_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ALS.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AI.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AI.INVOICE_TYPE_ID = 8 \
	AND ALS.ACTIVE = 1 \
	AND APL.AMOUNT > 0 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# -- Receiving Report - RM - Credit - AP Line Setup (Negative)
APInvoice8.sql.3.je=SELECT 'RECEIVING REPORT - RM' as SOURCE, AI.AP_INVOICE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AI.GL_DATE as GL_DATE, CONCAT('RR-RM ', AI.SEQUENCE_NO) as REFERENCE_NUMBER, COALESCE(AI.INVOICE_NUMBER, ', ', RR.DELIVERY_RECEIPT_NO) AS DESCRIPTION, \
	0 AS DEBIT, ABS(APL.AMOUNT) as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_INVOICE_LINE APL \
	INNER JOIN AP_INVOICE AI ON AI.AP_INVOICE_ID = APL.AP_INVOICE_ID \
	INNER JOIN R_RECEIVING_REPORT RR ON RR.AP_INVOICE_ID = APL.AP_INVOICE_ID \
	INNER JOIN AP_LINE_SETUP ALS ON ALS.AP_LINE_SETUP_ID = APL.AP_LINE_SETUP_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON AC.ACCOUNT_COMBINATION_ID = ALS.ACCOUNT_COMBINATION_ID \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AI.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AI.INVOICE_TYPE_ID = 8 \
	AND ALS.ACTIVE = 1 \
	AND APL.AMOUNT < 0 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
# -- Receiving Report - Raw Materials - Credit - Supplier Account - Default Credit
APInvoice8.sql.4.je=SELECT 'RECEIVING REPORT - RM' as SOURCE, AI.AP_INVOICE_ID as ID, AC.COMPANY_ID, AC.DIVISION_ID, AC.ACCOUNT_ID, D.NUMBER AS DIVISION_NO, D.NAME AS DIVISION_NAME, \
	A.NUMBER as ACCT_NO, A.ACCOUNT_NAME, AI.GL_DATE, CONCAT('RR-RM ', AI.SEQUENCE_NO) as REFERENCE_NUMBER, COALESCE(AI.INVOICE_NUMBER, ', ', RR.DELIVERY_RECEIPT_NO) as DESCRIPTION, \
	0 as DEBIT, AI.AMOUNT as CREDIT, FW.FORM_WORKFLOW_ID, FW.CURRENT_STATUS_ID, FW.IS_COMPLETE, FW.IS_COMPLETE as IS_POSTED, '' AS CUSTOMER_PO_NO, A.ACCOUNT_TYPE_ID \
	FROM AP_INVOICE AI \
	INNER JOIN R_RECEIVING_REPORT RR ON RR.AP_INVOICE_ID = AI.AP_INVOICE_ID \
	INNER JOIN SUPPLIER_ACCOUNT SPA ON SPA.SUPPLIER_ACCOUNT_ID = AI.SUPPLIER_ACCOUNT_ID \
	INNER JOIN ACCOUNT_COMBINATION AC ON \
	(AC.ACCOUNT_COMBINATION_ID = SPA.DEFAULT_CREDIT_AC_ID AND AC.COMPANY_ID = RR.COMPANY_ID) \
	INNER JOIN DIVISION D ON D.DIVISION_ID = AC.DIVISION_ID \
	INNER JOIN ACCOUNT A ON A.ACCOUNT_ID = AC.ACCOUNT_ID \
	INNER JOIN FORM_WORKFLOW FW ON AI.FORM_WORKFLOW_ID = FW.FORM_WORKFLOW_ID \
	WHERE AI.INVOICE_TYPE_ID = 8 \
	AND FW.CURRENT_STATUS_ID != 4 \
	AND AC.COMPANY_ID = IN_COMPANY_ID
APInvoice8.sql.je.jerr=AND AI.GL_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (CASE WHEN IN_REFERENCE_NUMBER NOT LIKE '-1' THEN CONCAT('RR-RM ', AI.SEQUENCE_NO) LIKE IN_REFERENCE_NUMBER \
		ELSE IN_REFERENCE_NUMBER LIKE IN_REFERENCE_NUMBER END) \
	AND (CASE IN_SOURCE WHEN 'RECEIVING REPORT - RM' THEN AI.AP_INVOICE_ID != 0 \
		WHEN 'ALL' THEN AI.AP_INVOICE_ID != 0 \
		ELSE AI.AP_INVOICE_ID = 0 END) \
	AND (CASE WHEN IN_IS_POSTED != -1 THEN FW.IS_COMPLETE = IN_IS_POSTED ELSE FW.IS_COMPLETE != IN_IS_POSTED END)
APInvoice8.sql.je.ab=AND AI.GL_DATE <= IN_AS_OF_DATE \
	AND FW.IS_COMPLETE = 1
APInvoice8.sql.je.aa=AND D.NUMBER BETWEEN IN_FROM_DIVISION AND IN_TO_DIVISION \
	AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AI.GL_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND (AI.INVOICE_NUMBER LIKE IN_DESCRIPTION OR RR.DELIVERY_RECEIPT_NO LIKE IN_DESCRIPTION) \
	AND FW.IS_COMPLETE = 1
APInvoice8.sql.je.gll=AND AC.ACCOUNT_ID = IN_ACCOUNT_ID \
	AND AI.GL_DATE BETWEEN DATE_FROM AND DATE_TO \
	AND FW.IS_COMPLETE = 1